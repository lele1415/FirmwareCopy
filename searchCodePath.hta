<Html>
<Head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<Title></Title>
<Script Language="VBScript">

Dim width,height
width=CreateObject("HtmlFile").ParentWindow.Screen.AvailWidth
Window.MoveTo width-400,300
Window.ResizeTo 400,240

Function LoadFile(Path)
    Set stm = CreateObject("Adodb.Stream") 
    stm.Type = 2 
    stm.mode = 3 
    stm.charset = "utf-8" 
    stm.Open 
    stm.LoadFromFile Path
    LoadFile = stm.ReadText()
    stm.close 
    Set stm = nothing
End Function

Function strCompare(str1,str2)
If Len(str1) < Len(str2) Then
    minLen=len(str1)
Else
    minLen=len(str2)
End If
flag=0
For i = 1 To minLen
    letter1=Mid(str1,i,1) 
    letter2=Mid(str2,i,1) 
    num1=Asc(letter1)
    num2=Asc(letter2)
    If num1 > num2 Then
        flag=1
        Exit For
    ElseIf num1 < num2 Then
        flag=-1
        Exit For
    End If
Next
    If flag = 0 Then
        If Len(str1) > Len(str2) Then
            flag=1
        Else
            flag=-1
        End If
    End If    
    strCompare=flag
End Function

Sub getAlpsLink()
Set Fso=CreateObject("Scripting.FileSystemObject")
set ws=CreateObject("WScript.Shell")
DeBug_flag=False
Dim alpsLink(19)
alpsCount = 0
currentDir = ws.CurrentDirectory
If DeBug_flag Then
    link="Z:\"
Else
    link=document.getElementById("source").value
End If
Set RootDirectory_1 = Fso.GetFolder(link)
Set ChildDirectory_1 = RootDirectory_1.SubFolders
For Each Folder_1 In ChildDirectory_1
    If Folder_1.Name = "alps" Then
        alpsLink(alpsCount) = link&"alps"
        alpsCount = alpsCount + 1
        Exit For
    Else
        Set RootDirectory_2 = Fso.GetFolder(link&Folder_1.Name&"\")
        Set ChildDirectory_2 = RootDirectory_2.SubFolders
        For Each Folder_2 In ChildDirectory_2
            If Folder_2.Name = "alps" Then
                alpsLink(alpsCount) = link&Folder_1.Name&"\alps"
                alpsCount = alpsCount + 1
                Exit For
            Else
                Set RootDirectory_3 = Fso.GetFolder(link&Folder_1.Name&"\"&Folder_2.Name&"\")
                Set ChildDirectory_3 = RootDirectory_3.SubFolders
                For Each Folder_3 In ChildDirectory_3
                    If Folder_3.Name = "alps" Then
                        alpsLink(alpsCount) = link&Folder_1.Name&"\"&Folder_2.Name&"\alps"
                        alpsCount = alpsCount + 1
                        Exit For
                    End If
                Next
            End If    
        Next   
    End If
Next

For j = 0 To (alpsCount-2)
    For k = (j+1) To (alpsCount-1)
        If strCompare(alpsLink(j),alpsLink(k)) > 0 Then
            strTmp = alpsLink(j)
            alpsLink(j) = alpsLink(k)
            alpsLink(k) = strTmp
        End If
    Next
Next

'For i = 0 To (alpsCount-1)
    'msgbox(alpsLink(i))
'Next

Set fwrite=Fso.CreateTextFile(currentDir&"\copy_new.hta",true,true)
text = LoadFile(currentDir&"\copy.hta")
textArray = split(text,vbLf)
LineCount = 385

For i = 0 To UBound(textArray) 
    'click=Msgbox(textArray(i),1)
    'If click=2 Then
        'Exit For
    'End If
    fwrite.WriteLine textArray(i)
    LineCount = LineCount - 1
    If LineCount = 0 Then
        For j = 0 To (alpsCount-1)
            fwrite.WriteLine ("<option value="""&alpsLink(j)&""">"&alpsLink(j)&"</option>")
        Next
    End If
Next    
fwrite.close
If (Not DeBug_flag) Then
    Fso.DeleteFile(currentDir&"\copy.hta")
    Fso.MoveFile currentDir&"\copy_new.hta",currentDir&"\copy.hta"
End If
msgbox("完成")

End Sub
</Script>
</Head>
<Body bgcolor="#FFFFFF">
请输入代码根目录的路径，如Z:\
<br><input type="text" id="source" />
<br><input type="button" onclick="getAlpsLink()" value="开始" />

</Body>
</Html>
